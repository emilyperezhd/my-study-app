{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/emilyperez/Study%20App/my-study-app/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\n// This weird code prevents the \"Too many connections\" error\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const db = globalForPrisma.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;"],"names":[],"mappings":";;;;AAAA;;AAEA,4DAA4D;AAC5D,MAAM;AAEC,MAAM,KAAK,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAE5D,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Users/emilyperez/Study%20App/my-study-app/src/app/actions.ts"],"sourcesContent":["'use server'\n\nimport { db } from \"../lib/db\";\nimport { revalidatePath } from \"next/cache\";\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { PromptTemplate } from \"@langchain/core/prompts\";\n\n// --- 1. BROWSER MOCKS (Prevents Crashes) ---\n// @ts-ignore\nif (!global.DOMMatrix) { global.DOMMatrix = class DOMMatrix { constructor() {} }; }\n// @ts-ignore\nif (!global.ImageData) { global.ImageData = class ImageData { constructor() {} }; }\n// @ts-ignore\nif (!global.Path2D) { global.Path2D = class Path2D { constructor() {} }; }\n\n// --- 2. SMART IMPORT (Prevents \"is not a function\" Error) ---\nlet pdfParse = require(\"pdf-parse\");\n// Check if Next.js wrapped it in a 'default' property\nif (typeof pdfParse !== 'function' && pdfParse.default) {\n    pdfParse = pdfParse.default;\n}\n// -----------------------------------------------------------\n\nexport async function uploadPdf(formData: FormData) {\n  try {\n    const file = formData.get(\"file\") as File;\n    if (!file) throw new Error(\"No file found\");\n\n    const arrayBuffer = await file.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n\n    // 3. Extract Text\n    let finalContent = \"No text found.\";\n    \n    try {\n        const data = await pdfParse(buffer);\n        if (data && data.text && data.text.trim().length > 0) {\n            finalContent = data.text;\n        } else {\n            finalContent = \"⚠️ This PDF appears to be empty or scanned (image-only). Text could not be extracted.\";\n        }\n    } catch (parseError) {\n        console.error(\"PDF Parse Error:\", parseError);\n        finalContent = \"⚠️ Error parsing PDF. File might be corrupted or encrypted.\";\n    }\n\n    // 4. Save to Database\n    await db.course.create({\n      data: {\n        title: file.name,\n        content: finalContent,\n      }\n    });\n\n    revalidatePath(\"/\");\n  } catch (error) {\n    console.error(\"Upload Error:\", error);\n  }\n}\n\nexport async function generateStudyGuide(id: string) {\n  try {\n    const note = await db.course.findUnique({ where: { id: id } });\n    if (!note || !note.content) throw new Error(\"Note not found\");\n\n    const model = new ChatOpenAI({ \n      modelName: \"gpt-4o-mini\", \n      openAIApiKey: process.env.OPENAI_API_KEY \n    });\n\n    const prompt = PromptTemplate.fromTemplate(\n      `You are a strict academic tutor. Create a structured study guide.\n       Rules: HTML format only, use <h1>, <h2>, <ul>, <strong>. No Markdown.\n       Text: {text}`\n    );\n\n    const chain = prompt.pipe(model);\n    const response = await chain.invoke({ text: note.content.slice(0, 15000) });\n\n    await db.course.update({\n      where: { id: id },\n      data: { summary: response.content as string }\n    });\n\n    revalidatePath(`/notes/${id}`);\n  } catch (error) {\n    console.error(\"AI Study Guide Error:\", error);\n  }\n}\n\nexport async function generateQuiz(id: string) {\n  try {\n    const note = await db.course.findUnique({ where: { id: id } });\n    if (!note || !note.content) throw new Error(\"Note not found\");\n\n    const model = new ChatOpenAI({\n      modelName: \"gpt-4o-mini\",\n      openAIApiKey: process.env.OPENAI_API_KEY,\n      temperature: 0.1, \n      modelKwargs: { response_format: { type: \"json_object\" } } \n    });\n\n    const prompt = PromptTemplate.fromTemplate(\n      `Generate 5 difficult multiple-choice questions based on the provided text.\n       Return JSON object: {{ \"questions\": [ {{ \"question\": \"...\", \"options\": [\"...\"], \"answer\": \"...\" }} ] }}\n       Text: {text}`\n    );\n\n    const chain = prompt.pipe(model);\n    const response = await chain.invoke({ text: note.content.slice(0, 15000) });\n    \n    const content = typeof response.content === 'string' ? response.content : JSON.stringify(response.content);\n    const data = JSON.parse(content);\n    \n    await db.question.createMany({\n      data: data.questions.map((q: any) => ({\n        courseId: id,\n        question: q.question,\n        options: q.options,\n        answer: q.answer\n      }))\n    });\n\n    revalidatePath(`/notes/${id}`);\n  } catch (error) {\n    console.error(\"AI Quiz Error:\", error);\n  }\n}\n\nexport async function saveQuizResult(courseId: string, score: number, total: number) {\n  try {\n    await db.quizResult.create({\n      data: {\n        courseId,\n        score,\n        total,\n      },\n    });\n    revalidatePath(`/notes/${courseId}`);\n  } catch (error) {\n    console.error(\"Save Error:\", error);\n  }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///Users/emilyperez/Study%20App/my-study-app/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {uploadPdf as '4029b1f2a07c9a7d620d4b958168233797a4861b20'} from 'ACTIONS_MODULE0'\nexport {generateStudyGuide as '409078de68a41a43e66f0601878397a73538990768'} from 'ACTIONS_MODULE0'\nexport {generateQuiz as '40f43fc974ff6928b7b3a2e6912cea9dbb69f4517b'} from 'ACTIONS_MODULE0'\nexport {saveQuizResult as '707237374e2ca69a57c875b3ea679e9f2e612c7182'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}